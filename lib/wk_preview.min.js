!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).wkPreview=t()}(this,function(){"use strict";var p={state:{scale:1,$stage:null,$btnPre:null,$btnNext:null,$btnClose:null,$previewMask:null,previewOptions:{}},commit:function(e,t){try{this.actions[e].call(this,t)}catch(e){}},actions:{set_scale:function(e){p.state.scale=e},set_preview_options:function(e){p.state.previewOptions=e},set_node_stage:function(e){p.state.$stage=e},set_node_btn_pre:function(e){p.state.$btnPre=e},set_node_btn_next:function(e){p.state.$btnNext=e},set_node_btn_close:function(e){p.state.$btnClose=e},set_node_preview:function(e){p.state.$previewMask=e},reset_state:function(){p.state={scale:1,$stage:null,$btnPre:null,$btnNext:null,$btnClose:null,$previewMask:null,previewOptions:{}}}}};function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tagName=t,this.attrs=n||{},this.children=o||""};function o(e,t,n){return new i(e,t,n)}function r(e){var t=e.tagName,n=e.attrs,e=e.children,o=document.createElement(t);return function(e,t){for(var n in t){var o=t[n];if("className"===n)e.className=o;else if("value"===n)["input","textarea"].includes(e.tagName)?e.value=o:e.setAttribute("value",o);else if("style"===n){if("string"==typeof o)e.style.cssText=o;else if("object"==s(o))for(var i in o)e.style[i]=o[i]}else"storeCommit"!=n&&e.setAttribute(n,o)}}(o,n),"storeCommit"in n&&p.commit(n.storeCommit,o),"string"==typeof e?(n=document.createTextNode(e),o.appendChild(n)):e.map(function(e){e instanceof i&&(e=r(e),o.appendChild(e))}),o}function f(){return!!window.navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone|MicroMessenger)/i)}var m=document.addEventListener?function(e,t,n){e&&t&&n&&e.addEventListener(t,n,!1)}:function(e,t,n){e&&t&&n&&e.attachEvent("on"+t,n)},d=document.removeEventListener?function(e,t,n){e&&t&&e.removeEventListener(t,n,!1)}:function(e,t,n){e&&t&&e.detachEvent("on"+t,n)};function b(i){var s=!1;return function(){for(var t=this,e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];s||(s=!0,window.requestAnimationFrame(function(e){i.apply(t,n),s=!1}))}}var e=f(),t=e?30:50,n=e?"5%":"20px",a=e?10:18,c="\n  position: absolute;\n  top: 50%;\n  margin-top: ".concat(t/2*-1,"px;\n  width: ").concat(t,"px;\n  height: ").concat(t,"px;\n  border-radius: 50%;\n  background-color: rgba(255,255,255,0.22);\n  z-index: 999;\n  cursor: pointer;\n  overflow: hidden;\n"),l=c+"\n  left: ".concat(n,";\n"),u="\n  box-sizing: border-box;\n  position: absolute;\n  top: 50%;\n  left: 36%;\n  margin-top: ".concat(a/2*-1,"px;\n  display: inline-block;\n  width: ").concat(a,"px;\n  height: ").concat(a,"px;\n  border-top: 3px solid #ccc;\n  border-left: 3px solid #ccc;\n  transform: rotate(-45deg);\n  border-radius: 2px;\n"),e="\nbox-sizing: border-box;\nposition: absolute;\nleft: 50%;\ntop: 50%;\ntransform: translate(-50%, -50%);\ndisplay: inline-block;\nbackground: #fff;\nborder-radius: 2px;\n",v={previewMask:"\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  z-index: 9999;\n  background-color: rgba(0,0,0,.55);\n",btnPre:l,btnNext:c+"\n  right: ".concat(n,";\n"),preIcon:u,nextIcon:"\n  box-sizing: border-box;\n  position: absolute;\n  top: 50%;\n  right: 36%;\n  margin-top: ".concat(a/2*-1,"px;\n  display: inline-block;\n  width: ").concat(a,"px;\n  height: ").concat(a,"px;\n  border-top: 3px solid #ccc;\n  border-left: 3px solid #ccc;\n  transform: rotate(135deg);\n  border-radius: 2px;\n"),stage:"\n  box-sizing: border-box;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%) scale(1);\n  max-height: 96vh;\n  max-width: 96%;\n  border-radius: 4px;\n  border: 2px solid #eee;\n  overflow: hidden;\n  cursor: pointer;\n  object-fit: contain;\n  transition: transform ease 0.05s;\n",btnClose:"\n  box-sizing: border-box;\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  display: inline-block;\n  width: ".concat(t,"px;\n  height: ").concat(t,"px;\n  border-radius: 50%;\n  overflow: hidden;\n  background: rgba(0,0,0,.55);\n  cursor: pointer;\n  transform: rotate(45deg) scale(0.8);\n"),closeIcon1:"\n  ".concat(e,"\n  width: 2px;\n  height: 50%;\n"),closeIcon2:"\n  ".concat(e,"\n  width: 50%;\n  height: 2px;\n")},h="JS-Preview-mask",g=o("div",{id:"JS-preview-btn-pre",style:v.btnPre,storeCommit:"set_node_btn_pre"},[o("span",{style:v.preIcon})]),x=o("div",{id:"JS-preview-btn-next",style:v.btnNext,storeCommit:"set_node_btn_next"},[o("span",{style:v.nextIcon})]),w=o("div",{id:"JS-preview-btn-close",style:v.btnClose,storeCommit:"set_node_btn_close"},[o("span",{style:v.closeIcon1}),o("span",{style:v.closeIcon2})]),y=function(e){e=e.sourceList[e.currentIndex]||"";return o("img",{id:"JS-preview-stage",style:v.stage,src:e,storeCommit:"set_node_stage"})};function _(e){var t,n=e.mount,e=(e=(t=e).sourceList,r(o("div",{id:h,style:v.previewMask,storeCommit:"set_node_preview"},[w,1<e.length?g:"",y(t),1<e.length?x:""])));n.appendChild(e)}function $(e,t){var n=t.pageX-e.pageX,e=t.pageY-e.pageY;return Math.sqrt(n*n+e*e)}function k(e,t){var n=e.pageX-t.pageX,t=e.pageY-t.pageY;return 180*Math.atan2(t,n)/Math.PI}var C=!window.navigator.userAgent.match(/firefox/i)?"mousewheel":"DOMMouseScroll",I=b(function(e){var t,n,o=null!==(n=null==e?void 0:e.wheelDelta)&&void 0!==n?n:-e.detail;t=o,n=p.state,e=n.$stage,o=n.previewOptions,o=null!==(n=null==o?void 0:o.zoom)&&void 0!==n?n:5,n=t/120*.035,t=p.state.scale,t=(t+=n)<.3?.3:o<t?o:t,p.commit("set_scale",t),e.style.transform="translate(-50%, -50%) scale(".concat(p.state.scale,")")}),M=function(){var o,i,s,r,e=p.state,a=e.$stage,c=e.previewOptions;(s=!(i={}),r=[],(o=a).addEventListener("touchstart",function(e){2<=e.touches.length&&(s=!0,r=e.touches)},!1),document.addEventListener("touchmove",function(e){var t,n;e.preventDefault(),2<=e.touches.length&&s&&(t=$((n=e.touches)[0],n[1])/$(r[0],r[1]),n=k(n[0],n[1])-k(r[0],r[1]),e.scale=t.toFixed(2),e.rotation=n.toFixed(2),i.gesturemove&&i.gesturemove.call(o,e))},!1),document.addEventListener("touchend",function(e){s=s&&!1},!1),i).gesturemove=function(e){var t=null!==(n=null==c?void 0:c.zoom)&&void 0!==n?n:5,n=1<e.scale?.035*e.scale:-.035*e.scale,e=p.state.scale,e=(e+=n)<.3?.3:t<e?t:e;p.commit("set_scale",e),a.style.transform="translate(-50%, -50%) scale(".concat(p.state.scale,")")}};var L=function(){var a=f(),e=a?"touchstart":"mousedown",c=a?"touchmove":"mousemove",l=a?"touchend":"mouseup",u=p.state.$stage;m(u,e,function(e){var t,n,o,i,s,r;a&&1<e.touches.length||(e=a?e.touches[0]:e,t=[u.offsetLeft,u.offsetTop],n=t[0],o=t[1],i=e.pageX,s=e.pageY,r=b(function(e){var t;a&&1<e.touches.length||(e=a?e.touches[0]:e,t=n+e.pageX-i,e=o+e.pageY-s,u.style.left=t+"px",u.style.top=e+"px")}),m(document,c,r),m(document,l,function(e){d(document,c,r)}),e.preventDefault())})};function S(){var e,t,n,o,i,s,r,a,c,l,u,d;e=(s=p.state).previewOptions,t=s.$btnPre,n=s.$btnNext,o=s.$stage,i=s.$previewMask,s=s.$btnClose,r=e.sourceList,a=e.loop,c=e.mount,l=e.currentIndex,u=r.length,d="",m(t,"click",function(){if(0==l){if(!a)return!1;l=u}d=r[--l],o.setAttribute("src",d),p.commit("set_scale",1),o.style.cssText=v.stage}),m(n,"click",function(){if(u-1<=l){if(!a)return!1;l=-1}d=r[++l],o.setAttribute("src",d),p.commit("set_scale",1),o.style.cssText=v.stage}),m(s,"click",function(){c.removeChild(i),p.commit("reset_state")}),f()?M():m(document,C,I),function(){L.call(this)}()}return function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};null!==(t=e.mount)&&void 0!==t||(e.mount=document.body),null!==(t=e.sourceList)&&void 0!==t||(e.sourceList=[]),null!==(t=e.currentIndex)&&void 0!==t||(e.currentIndex=0),null!==(t=e.loop)&&void 0!==t||(e.loop=!1),null!==(t=e.zoom)&&void 0!==t||(e.zoom=5);var t=e.sourceList.length-1;if(e.currentIndex>t&&(e.currentIndex=t),e.currentIndex<0&&(e.currentIndex=0),p.commit("set_preview_options",e),!e.sourceList.length)throw new Error("Media resources is required");_(e),S.call(this),console.log(p)}});

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).wkPreview=e()}(this,function(){"use strict";var p={state:{scale:1,$stage:null,$btnPre:null,$btnNext:null,$btnClose:null,$previewMask:null,previewOptions:{}},commit:function(t,e){try{this.actions[t].call(this,e)}catch(t){}},actions:{set_scale:function(t){p.state.scale=t},set_preview_options:function(t){p.state.previewOptions=t},set_node_stage:function(t){p.state.$stage=t},set_node_btn_pre:function(t){p.state.$btnPre=t},set_node_btn_next:function(t){p.state.$btnNext=t},set_node_btn_close:function(t){p.state.$btnClose=t},set_node_preview:function(t){p.state.$previewMask=t},reset_state:function(){p.state={scale:1,$stage:null,$btnPre:null,$btnNext:null,$btnClose:null,$previewMask:null,previewOptions:{}}}}};function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i=function t(e,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tagName=e,this.attrs=n||{},this.children=o||""};function o(t,e,n){return new i(t,e,n)}function r(t){var e=t.tagName,n=t.attrs,t=t.children,o=document.createElement(e);return function(t,e){for(var n in e){var o=e[n];if("className"===n)t.className=o;else if("value"===n)["input","textarea"].includes(t.tagName)?t.value=o:t.setAttribute("value",o);else if("style"===n){if("string"==typeof o)t.style.cssText=o;else if("object"==s(o))for(var i in o)t.style[i]=o[i]}else"storeCommit"!=n&&t.setAttribute(n,o)}}(o,n),"storeCommit"in n&&p.commit(n.storeCommit,o),"string"==typeof t?(n=document.createTextNode(t),o.appendChild(n)):t.map(function(t){t instanceof i&&(t=r(t),o.appendChild(t))}),o}function f(){return!!window.navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone|MicroMessenger)/i)}var m=document.addEventListener?function(t,e,n){t&&e&&n&&t.addEventListener(e,n,!1)}:function(t,e,n){t&&e&&n&&t.attachEvent("on"+e,n)},d=document.removeEventListener?function(t,e,n){t&&e&&t.removeEventListener(e,n,!1)}:function(t,e,n){t&&e&&t.detachEvent("on"+e,n)};function b(i){var s=!1;return function(){for(var e=this,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];s||(s=!0,window.requestAnimationFrame(function(t){i.apply(e,n),s=!1}))}}var t=f(),e=t?30:50,n=t?"5%":"20px",a=t?10:18,c="\n  position: absolute;\n  top: 50%;\n  margin-top: ".concat(e/2*-1,"px;\n  width: ").concat(e,"px;\n  height: ").concat(e,"px;\n  border-radius: 50%;\n  background-color: rgba(255,255,255,0.22);\n  z-index: 999;\n  cursor: pointer;\n  overflow: hidden;\n"),l=c+"\n  left: ".concat(n,";\n"),u="\n  box-sizing: border-box;\n  position: absolute;\n  top: 50%;\n  left: 36%;\n  margin-top: ".concat(a/2*-1,"px;\n  display: inline-block;\n  width: ").concat(a,"px;\n  height: ").concat(a,"px;\n  border-top: 3px solid #ccc;\n  border-left: 3px solid #ccc;\n  transform: rotate(-45deg);\n  border-radius: 2px;\n"),t="\nbox-sizing: border-box;\nposition: absolute;\nleft: 50%;\ntop: 50%;\ntransform: translate(-50%, -50%);\ndisplay: inline-block;\nbackground: #fff;\nborder-radius: 2px;\n",v={previewMask:"\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  z-index: 9999;\n  background-color: rgba(0,0,0,.55);\n",btnPre:l,btnNext:c+"\n  right: ".concat(n,";\n"),preIcon:u,nextIcon:"\n  box-sizing: border-box;\n  position: absolute;\n  top: 50%;\n  right: 36%;\n  margin-top: ".concat(a/2*-1,"px;\n  display: inline-block;\n  width: ").concat(a,"px;\n  height: ").concat(a,"px;\n  border-top: 3px solid #ccc;\n  border-left: 3px solid #ccc;\n  transform: rotate(135deg);\n  border-radius: 2px;\n"),stage:"\n  box-sizing: border-box;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%) scale(1);\n  max-height: 96vh;\n  max-width: 96%;\n  border-radius: 4px;\n  border: 2px solid #eee;\n  overflow: hidden;\n  cursor: pointer;\n  object-fit: contain;\n  transition: transform ease 0.05s;\n",btnClose:"\n  box-sizing: border-box;\n  position: absolute;\n  top: 20px;\n  right: 20px;\n  display: inline-block;\n  width: ".concat(e,"px;\n  height: ").concat(e,"px;\n  border-radius: 50%;\n  overflow: hidden;\n  background: rgba(0,0,0,.55);\n  cursor: pointer;\n  transform: rotate(45deg) scale(0.8);\n"),closeIcon1:"\n  ".concat(t,"\n  width: 2px;\n  height: 50%;\n"),closeIcon2:"\n  ".concat(t,"\n  width: 50%;\n  height: 2px;\n")},h="JS-Preview-mask",g=o("div",{id:"JS-preview-btn-pre",style:v.btnPre,storeCommit:"set_node_btn_pre"},[o("span",{style:v.preIcon})]),x=o("div",{id:"JS-preview-btn-next",style:v.btnNext,storeCommit:"set_node_btn_next"},[o("span",{style:v.nextIcon})]),w=o("div",{id:"JS-preview-btn-close",style:v.btnClose,storeCommit:"set_node_btn_close"},[o("span",{style:v.closeIcon1}),o("span",{style:v.closeIcon2})]),y=function(t){t=t.sourceList[t.currentIndex]||"";return o("img",{id:"JS-preview-stage",style:v.stage,src:t,storeCommit:"set_node_stage"})};function _(t){var e,n=t.mount,t=(t=(e=t).sourceList,r(o("div",{id:h,style:v.previewMask,storeCommit:"set_node_preview"},[w,1<t.length?g:"",y(e),1<t.length?x:""])));n.appendChild(t)}function $(t,e){var n=e.pageX-t.pageX,t=e.pageY-t.pageY;return Math.sqrt(n*n+t*t)}function k(t,e){var n=t.pageX-e.pageX,e=t.pageY-e.pageY;return 180*Math.atan2(e,n)/Math.PI}var C=!window.navigator.userAgent.match(/firefox/i)?"mousewheel":"DOMMouseScroll",M=b(function(t){var e,n,o=null!==(n=null==t?void 0:t.wheelDelta)&&void 0!==n?n:-t.detail;e=o,n=p.state,t=n.$stage,o=n.previewOptions,o=null!==(n=null==o?void 0:o.zoom)&&void 0!==n?n:5,n=e/120*.035,e=p.state.scale,e=(e+=n)<.3?.3:o<e?o:e,p.commit("set_scale",e),t.style.transform="translate(-50%, -50%) scale(".concat(p.state.scale,")")}),I=function(){var o,i,s,r,t=p.state,a=t.$stage,c=t.previewOptions;(s=!(i={}),r=[],(o=a).addEventListener("touchstart",function(t){2<=t.touches.length&&(s=!0,r=t.touches)},!1),document.addEventListener("touchmove",function(t){var e,n;t.preventDefault(),2<=t.touches.length&&s&&(e=$((n=t.touches)[0],n[1])/$(r[0],r[1]),n=k(n[0],n[1])-k(r[0],r[1]),t.scale=e.toFixed(2),t.rotation=n.toFixed(2),i.gesturemove&&i.gesturemove.call(o,t))},!1),document.addEventListener("touchend",function(t){s=s&&!1},!1),i).gesturemove=function(t){var e=null!==(n=null==c?void 0:c.zoom)&&void 0!==n?n:5,n=1<t.scale?.035*t.scale:-.035*t.scale,t=p.state.scale,t=(t+=n)<.3?.3:e<t?e:t;p.commit("set_scale",t),a.style.transform="translate(-50%, -50%) scale(".concat(p.state.scale,")")}};var L=function(){var a=f(),t=a?"touchstart":"mousedown",c=a?"touchmove":"mousemove",l=a?"touchend":"mouseup",u=p.state.$stage;m(u,t,function(t){var e,n,o,i,s,r;a&&1<t.touches.length||(t=a?t.touches[0]:t,e=[u.offsetLeft,u.offsetTop],n=e[0],o=e[1],i=t.pageX,s=t.pageY,r=b(function(t){var e;a&&1<t.touches.length||(t=a?t.touches[0]:t,e=n+t.pageX-i,t=o+t.pageY-s,u.style.left=e+"px",u.style.top=t+"px")}),m(document,c,r),m(document,l,function(t){d(document,c,r)}),t.preventDefault())})};function S(){var t,e,n,o,i,s,r,a,c,l,u,d;t=(s=p.state).previewOptions,e=s.$btnPre,n=s.$btnNext,o=s.$stage,i=s.$previewMask,s=s.$btnClose,r=t.sourceList,a=t.loop,c=t.mount,l=t.currentIndex,u=r.length,d="",m(e,"click",function(){if(0==l){if(!a)return!1;l=u}d=r[--l],o.setAttribute("src",d),p.commit("set_scale",1),o.style.cssText=v.stage}),m(n,"click",function(){if(u-1<=l){if(!a)return!1;l=-1}d=r[++l],o.setAttribute("src",d),p.commit("set_scale",1),o.style.cssText=v.stage}),m(s,"click",function(){c.removeChild(i),p.commit("reset_state")}),f()?I():m(document,C,M),function(){L.call(this)}()}return function(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(null!==(t=e.mount)&&void 0!==t||(e.mount=document.body),null!==(t=e.sourceList)&&void 0!==t||(e.sourceList=[]),null!==(t=e.currentIndex)&&void 0!==t||(e.currentIndex=0),null!==(t=e.loop)&&void 0!==t||(e.loop=!1),null!==(t=e.zoom)&&void 0!==t||(e.zoom=5),p.commit("set_preview_options",e),!e.sourceList.length)throw new Error("Media resources is required");_(e),S.call(this),console.log(p)}});
